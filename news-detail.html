<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Detail - News Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/social-share.css">
    <script src="/js/social-share.js" defer></script>
    <link href="css/news-detail.css" rel="stylesheet">
    <link href="css/article-navigation.css" rel="stylesheet">
    <link href="css/sidebar.css" rel="stylesheet">
    <link href="css/related-articles.css" rel="stylesheet">

    <!-- Google AdSense -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YEJYBRRRL7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-YEJYBRRRL7');
    </script>
   
</head>

<body>

    <div class="loader-container">
        <div class="loader"></div>
    </div>

    <!-- Component Containers -->
    <div id="header-container"></div>
    <div id="navigation-container"></div>

    <main class="container-fluid py-4 main-content">
        <div class="row">
            <!-- Left Sidebar - Ads -->
            <div class="col-lg-2">
                <div class="sticky-sidebar">
                    <div class="ad-space vertical-ad mb-4" id="left-sidebar-ad">
                        <div class="ad-container">
                            <ins class="adsbygoogle" 
                                style="display:block" 
                                data-ad-client="ca-pub-6284022198338659"
                                data-ad-slot="9038226694" 
                                data-ad-format="auto" 
                                data-full-width-responsive="true"></ins>
                        </div>
                        <!-- Backup content for unfilled ads -->
                        <div class="ad-backup-content" style="display: none;">
                            <div class="sponsored-content">
                                <h6>ðŸ“° Trending Stories</h6>
                                <div class="list-group list-group-flush">
                                    <a href="/trending" class="list-group-item list-group-item-action small">
                                        Hot topics this week
                                    </a>
                                    <a href="/breaking" class="list-group-item list-group-item-action small">
                                        Breaking news
                                    </a>
                                    <a href="/popular" class="list-group-item list-group-item-action small">
                                        Most read articles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-7">
                <article id="newsDetail" class="news-article">
                    <div class="breadcrumb-wrapper">
                        <div class="container p-0">
                            <nav aria-label="breadcrumb" class="custom-breadcrumb">
                                <ol class="breadcrumb align-items-center">
                                    <li class="breadcrumb-item">
                                        <a href="index.html" class="home-link">
                                            <i class="bi bi-house-door-fill"></i>
                                            <span>Home</span>
                                        </a>
                                    </li>
                                    <li class="breadcrumb-separator">
                                        <i class="bi bi-chevron-right"></i>
                                    </li>
                                    <li class="breadcrumb-item active news-title text-truncate">
                                        <span class="truncate-text"></span>
                                        <span class="ellipsis">...</span>
                                    </li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- Top Ad Banner -->
                    <div class="ad-section-responsive mb-4">
                        <div class="ad-banner-horizontal" id="top-banner-ad">
                            <ins class="adsbygoogle" 
                                style="display:block" 
                                data-ad-client="ca-pub-6284022198338659"
                                data-ad-slot="3330604448" 
                                data-ad-format="auto" 
                                data-full-width-responsive="true"></ins>
                            <!-- Backup content for unfilled ads -->
                            
                        </div>
                    </div>

                    <div class="article-header mb-4">
                        <div class="category-badge"></div>
                        <h1 class="article-title"></h1>
                        <div class="article-meta">
                            <span class="author"></span>
                            <span class="date"></span>
                            <span class="reading-time"></span>
                        </div>
                    </div>

                    <!-- Featured Image -->
                    <div class="featured-image-container mb-4"></div>

                    <!-- Social Share Buttons -->
                    <div class="social-share mb-4">
                        <button class="share-btn facebook"><i class="bi bi-facebook"></i></button>
                        <button class="share-btn twitter"><i class="bi bi-twitter"></i></button>
                        <button class="share-btn whatsapp"><i class="bi bi-whatsapp"></i></button>
                    </div>

                    <!-- Article Content -->
                    <div class="article-content">
                        <!-- Content will be loaded dynamically in sections -->
                    </div>

                    <!-- Mid-Article Ad -->
                    <div class="ad-section-responsive my-4">
                        <div class="ad-banner-horizontal" id="mid-article-ad">
                            <ins class="adsbygoogle" 
                                style="display:block" 
                                data-ad-client="ca-pub-6284022198338659"
                                data-ad-slot="6412063350" 
                                data-ad-format="auto" 
                                data-full-width-responsive="true"></ins>
                        </div>
                    </div>

                    <!-- Author Bio -->
                    <div class="author-bio mt-4">
                        <div class="author-image"></div>
                        <div class="author-info">
                            <h4 class="author-name"></h4>
                            <p class="author-description"></p>
                        </div>
                    </div>

                    <!-- Tags -->
                    <div class="article-tags mt-4"></div>

                    <!-- Comments Section -->
                    <div class="comments-section mt-4">
                        <h3>Comments (<span id="commentCount">0</span>)</h3>
                        <div id="commentsContainer" class="comments-list mb-4"></div>
                        <div class="comment-form mt-4">
                            <div id="loginPrompt" class="alert alert-info d-none">
                                Please <a href="/pages/login.html" id="loginLink">login</a> to post a comment.
                            </div>
                            <div id="commentFormContent">
                                <textarea id="commentText" class="form-control" placeholder="Write your comment..."
                                    rows="3"></textarea>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted">Maximum 500 characters</small>
                                    <button id="postComment" class="btn btn-primary">Post Comment</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

                <nav class="article-navigation">
                    <div class="nav-links">
                        <a id="prevArticle" class="nav-item prev" href="#" tabindex="0">
                            <div class="nav-content">
                                <span class="nav-label">Previous Article</span>
                                <h4 class="nav-title"></h4>
                                <span class="nav-meta">
                                    <i class="bi bi-arrow-left"></i>
                                    <span class="nav-category"></span>
                                </span>
                            </div>
                        </a>
                        <div class="nav-separator"></div>
                        <a id="nextArticle" class="nav-item next" href="#" tabindex="0">
                            <div class="nav-content">
                                <span class="nav-label">Next Article</span>
                                <h4 class="nav-title"></h4>
                                <span class="nav-meta">
                                    <span class="nav-category"></span>
                                    <i class="bi bi-arrow-right"></i>
                                </span>
                            </div>
                        </a>
                    </div>
                </nav>
                
                <!-- Bottom Ad Banner -->
                <div class="ad-section-responsive mb-4">
                    <div class="ad-banner-horizontal" id="bottom-banner-ad">
                        <ins class="adsbygoogle" 
                            style="display:block" 
                            data-ad-client="ca-pub-6284022198338659"
                            data-ad-slot="8172701732" 
                            data-ad-format="auto" 
                            data-full-width-responsive="true"></ins>
                        <!-- Backup content for unfilled ads -->
                        
                    </div>
                </div>

                <section class="read-more-section">
                    <div class="container p-0">
                        <h3 class="section-title">Related Articles</h3>
                        <div class="related-articles" id="relatedArticlesContainer">
                            <!-- Articles will be populated dynamically -->
                        </div>
                    </div>
                </section>
                
                <!-- Related Articles Ad -->
                <div class="ad-section-responsive mt-4">
                    <div class="ad-banner-horizontal" id="related-articles-ad">
                        <ins class="adsbygoogle" 
                            style="display:block" 
                            data-ad-client="ca-pub-6284022198338659"
                            data-ad-slot="1606582944" 
                            data-ad-format="auto" 
                            data-full-width-responsive="true"></ins>
                        <!-- Backup content for unfilled ads -->
                       
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="col-lg-3">
                <div class="sticky-sidebar">
                    <!-- Latest News -->
                    <div class="sidebar-section mb-4">
                        <h4>Latest News</h4>
                        <div id="latestNewsContainer" class="text-truncate-container"></div>
                    </div>

                    <!-- Category News -->
                    <div class="sidebar-section mb-4">
                        <h4>Category News</h4>
                        <div id="categoryNewsContainer" class="text-truncate-container"></div>
                    </div>

                    <!-- Popular News -->
                    <div class="sidebar-section mb-4">
                        <h4>Most Read</h4>
                        <div id="popularNewsContainer" class="text-truncate-container"></div>
                    </div>

                    <!-- Advertisement -->
                    <div class="ad-space sidebar-ad mb-4" id="right-sidebar-ad">
                        <div class="ad-container">
                            <ins class="adsbygoogle" 
                                style="display:block" 
                                data-ad-client="ca-pub-6284022198338659"
                                data-ad-slot="4287736546" 
                                data-ad-format="auto" 
                                data-full-width-responsive="true"></ins>
                        </div>
                        <!-- Backup content for unfilled ads -->
                        <div class="ad-backup-content" style="display: none;">
                            <div class="sponsored-content">
                                <h6>ðŸ”¥ Popular Now</h6>
                                <div class="list-group list-group-flush">
                                    <a href="/trending" class="list-group-item list-group-item-action small">
                                        Trending stories
                                    </a>
                                    <a href="/viral" class="list-group-item list-group-item-action small">
                                        Viral content
                                    </a>
                                    <a href="/exclusive" class="list-group-item list-group-item-action small">
                                        Exclusive reports
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="reading-progress"></div>
    <div id="footer-container"></div>

    <!-- AdSense Script -->
    <script>
        (function() {
            var script = document.createElement('script');
            script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6284022198338659';
            script.crossOrigin = 'anonymous';
            script.async = true;
            document.head.appendChild(script);
        })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="js/components/component-loader.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/news-detail.js"></script>
    <script type="module" src="js/sidebar-content.js"></script>
    <script type="module" src="js/article-navigation.js"></script>
    <script type="module" src="js/related-articles.js"></script>

    <!-- Enhanced AdSense Initialization -->
    <script>
        // Enhanced AdSense initialization with fallback handling
        function initializeAdSense() {
            console.log('ðŸš€ Initializing AdSense for news detail page...');
            
            if (window.adsbygoogle) {
                // Configure global AdSense settings for better fill rates
                window.adsbygoogle = window.adsbygoogle || [];
                window.adsbygoogle.push({
                    params: {
                        // Enhanced targeting parameters
                        page_url: window.location.href,
                        referrer: document.referrer
                    }
                });
                
                // Initialize all ads
                (adsbygoogle = window.adsbygoogle || []).push({});
                console.log('âœ… AdSense initialized successfully');
                
                // Set up monitoring for unfilled ads
                setTimeout(monitorAdStatus, 3000);
                
                // Set up periodic refresh for better fill rates
                setupAdRefresh();
            } else {
                console.log('âš ï¸ AdSense not loaded yet, retrying...');
                setTimeout(initializeAdSense, 1000);
            }
        }

        // Monitor ad status and handle unfilled ads
        function monitorAdStatus() {
            const ads = document.querySelectorAll('ins.adsbygoogle');
            console.log(`ðŸ” Monitoring ${ads.length} ad units...`);
            
            ads.forEach((ad, index) => {
                const status = ad.getAttribute('data-ad-status');
                const container = ad.closest('.ad-container, .ad-banner-horizontal');
                const backupContent = container ? container.querySelector('.ad-backup-content') : null;
                
                console.log(`Ad ${index + 1} (Slot: ${ad.getAttribute('data-ad-slot')}) status:`, status);
                
                if (status === 'unfilled') {
                    console.log(`âŒ Ad slot ${ad.getAttribute('data-ad-slot')} is unfilled - showing backup content`);
                    
                    // Show backup content after 5 seconds if ad remains unfilled
                    setTimeout(() => {
                        if (ad.getAttribute('data-ad-status') === 'unfilled' && backupContent) {
                            ad.style.display = 'none';
                            backupContent.style.display = 'block';
                            console.log(`âœ… Backup content displayed for slot ${ad.getAttribute('data-ad-slot')}`);
                        }
                    }, 5000);
                    
                    // Try to refresh the ad after 30 seconds
                    setTimeout(() => refreshAd(ad), 30000);
                } else if (status === 'filled') {
                    console.log(`âœ… Ad slot ${ad.getAttribute('data-ad-slot')} is filled successfully`);
                    if (backupContent) {
                        backupContent.style.display = 'none';
                    }
                }
            });
        }

        // Refresh individual ad
        function refreshAd(adElement) {
            const slot = adElement.getAttribute('data-ad-slot');
            console.log(`ðŸ”„ Refreshing ad: ${slot}`);
            
            // Remove and re-add the ad element
            const parent = adElement.parentElement;
            const backupContent = parent.nextElementSibling;
            
            if (backupContent && backupContent.style.display === 'block') {
                backupContent.style.display = 'none';
            }
            
            const newAd = adElement.cloneNode(true);
            parent.removeChild(adElement);
            parent.appendChild(newAd);
            
            // Reinitialize
            if (window.adsbygoogle) {
                (adsbygoogle = window.adsbygoogle || []).push({});
            }
        }

        // Auto-refresh ads periodically for better fill rates
        function setupAdRefresh() {
            setInterval(() => {
                console.log('ðŸ”„ Auto-refreshing ads...');
                if (window.adsbygoogle) {
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    // Re-monitor status after refresh
                    setTimeout(monitorAdStatus, 2000);
                }
            }, 180000); // Refresh every 3 minutes
        }

        // Manual ad refresh function (call this if needed)
        window.refreshAllAds = function() {
            console.log('ðŸ”„ Manually refreshing all ads...');
            if (window.adsbygoogle) {
                (adsbygoogle = window.adsbygoogle || []).push({});
                setTimeout(monitorAdStatus, 2000);
            }
        };

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“„ DOM loaded - starting ad initialization');
            initializeAdSense();
        });

        // Initialize when window loads
        window.addEventListener('load', function() {
            console.log('ðŸŒ Window loaded - final ad initialization');
            setTimeout(initializeAdSense, 1000);
        });

        // Debug function
        function debugAds() {
            console.log('=== AD DEBUG INFO ===');
            const ads = document.querySelectorAll('ins.adsbygoogle');
            console.log('Total ad units found:', ads.length);
            
            ads.forEach((ad, index) => {
                const rect = ad.getBoundingClientRect();
                const styles = window.getComputedStyle(ad);
                console.log(`Ad ${index + 1} (Slot: ${ad.getAttribute('data-ad-slot')}):`, {
                    visible: rect.width > 0 && rect.height > 0,
                    dimensions: `${Math.round(rect.width)}x${Math.round(rect.height)}`,
                    display: styles.display,
                    visibility: styles.visibility,
                    status: ad.getAttribute('data-ad-status'),
                    parentVisible: ad.parentElement.offsetHeight > 0
                });
            });
        }

        // Run debug after load
        setTimeout(debugAds, 5000);

        // Expose debug function globally
        window.debugAds = debugAds;
    </script>
</body>

</html>